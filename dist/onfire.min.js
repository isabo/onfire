(function(){var e=this;function aa(){}
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function g(a){return"function"==ba(a)}function ca(a,b,c){return a.call.apply(a.bind,arguments)}function da(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function h(a,b,c){h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ca:da;return h.apply(null,arguments)}function fa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function m(a,b){var c=a.split("."),d=e;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)c.length||void 0===b?d[f]?d=d[f]:d=d[f]={}:d[f]=b}
function n(a,b){function c(){}c.prototype=b.prototype;a.aa=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.ba=function(a,c,l){for(var k=Array(arguments.length-2),t=2;t<arguments.length;t++)k[t-2]=arguments[t];return b.prototype[c].apply(a,k)}};m("onfire.model.Error",{INVALID_REF:"Invalid ref argument - it must be an onfire.Ref instance",NOT_LOADED:"Not loaded yet",NO_SUCH_KEY:"No such key",NOT_A_MODEL:"Not a model",NOT_A_PRIMITIVE:"Not a primitive"});function p(a){switch(typeof a){case "function":return q;case "object":return void 0!==a.$id?r:u}switch(a){case "string":return v;case "number":return w;case "boolean":return x;default:return ga}}var v=0,w=1,x=2,u=3,r=4,q=5,ga=-1;var z="undefined"!==typeof module&&!!module.exports;function A(a){B("info",arguments)}function ha(a){B("warn",arguments)}function C(a){B("error",arguments)}function B(a,b){var c=Array.prototype.slice.call(b,0);c.unshift("ONFIRE:");"function"===typeof console[a]?console[a].apply(console,c):console.log.apply(console,c)};function ia(a,b){this.c=a;this.f=b;this.b=0;this.a=null}function ja(a){var b;0<a.b?(a.b--,b=a.a,a.a=b.next,b.next=null):b=a.c();return b}function ka(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function la(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};var ma=Array.prototype;function na(a){return ma.concat.apply(ma,arguments)};function oa(){this.b=this.a=null}var qa=new ia(function(){return new pa},function(a){a.reset()});function ra(){var a=sa,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function pa(){this.next=this.b=this.a=null}pa.prototype.reset=function(){this.next=this.b=this.a=null};var D;a:{var ta=e.navigator;if(ta){var ua=ta.userAgent;if(ua){D=ua;break a}}D=""}function E(a){return-1!=D.indexOf(a)};function va(){return E("Edge")||E("Trident")||E("MSIE")};function wa(a){e.setTimeout(function(){throw a;},0)}var xa;
function ya(){var a=e.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!E("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=h(function(a){if(("*"==d||a.origin==d)&&a.data==
c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!va()){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.Z;c.Z=null;a()}};return function(a){d.next={Z:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");b.onreadystatechange=
function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){e.setTimeout(a,0)}};function F(a,b){this.b={};this.a=[];this.f=this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)G(this,arguments[d],arguments[d+1])}else if(a){if(a instanceof F)c=a.G(),d=a.H();else{var c=la(a),f=[],l=0;for(d in a)f[l++]=a[d];d=f}for(f=0;f<c.length;f++)G(this,c[f],d[f])}}F.prototype.H=function(){za(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};F.prototype.G=function(){za(this);return this.a.concat()};
F.prototype.clear=function(){this.b={};this.f=this.c=this.a.length=0};function za(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];H(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){for(var f={},c=b=0;b<a.a.length;)d=a.a[b],H(f,d)||(a.a[c++]=d,f[d]=1),b++;a.a.length=c}}function I(a,b){return H(a.b,b)?a.b[b]:void 0}function G(a,b,c){H(a.b,b)||(a.c++,a.a.push(b),a.f++);a.b[b]=c}
F.prototype.forEach=function(a,b){for(var c=this.G(),d=0;d<c.length;d++){var f=c[d];a.call(b,I(this,f),f,this)}};F.prototype.clone=function(){return new F(this)};function H(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Aa(a,b){J||Ba();K||(J(),K=!0);var c=sa,d=ja(qa);d.a=a;d.b=b;d.next=null;c.b?c.b.next=d:c.a=d;c.b=d}var J;function Ba(){if(e.Promise&&e.Promise.resolve){var a=e.Promise.resolve();J=function(){a.then(Ca)}}else J=function(){var a=Ca;!g(e.setImmediate)||e.Window&&e.Window.prototype&&e.Window.prototype.setImmediate==e.setImmediate?(xa||(xa=ya()),xa(a)):e.setImmediate(a)}}var K=!1,sa=new oa;[].push(function(){K=!1;sa=new oa});
function Ca(){for(var a=null;a=ra();){try{a.a.call(a.b)}catch(b){wa(b)}ka(qa,a)}K=!1};function L(a,b){this.a=M;this.i=void 0;this.c=this.b=this.g=null;this.f=this.h=!1;if(a==Da)N(this,O,b);else try{var c=this;a.call(b,function(a){N(c,O,a)},function(a){try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}N(c,P,a)})}catch(d){N(this,P,d)}}var M=0,O=2,P=3;function Ea(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}Ea.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var Fa=new ia(function(){return new Ea},function(a){a.reset()});
function Ga(a,b,c){var d=ja(Fa);d.f=a;d.b=b;d.c=c;return d}function Da(){}function Ha(a){return new L(function(b,c){var d=a.length,f=[];if(d)for(var l=function(a,c){d--;f[a]=c;0==d&&b(f)},k=function(a){c(a)},t=0,y;y=a[t];t++)Ia(y,fa(l,t),k);else b(f)})}L.prototype.then=function(a,b,c){return Ja(this,g(a)?a:null,g(b)?b:null,c)};L.prototype.then=L.prototype.then;L.prototype.$goog_Thenable=!0;function Ia(a,b,c,d){a instanceof L?Ka(a,Ga(b||aa,c||null,d)):a.then(b,c,d)}
function Ka(a,b){a.b||a.a!=O&&a.a!=P||La(a);a.c?a.c.next=b:a.b=b;a.c=b}function Ja(a,b,c,d){var f=Ga(null,null,null);f.a=new L(function(a,k){f.f=b?function(c){try{var f=b.call(d,c);a(f)}catch(ea){k(ea)}}:a;f.b=c?function(b){try{var f=c.call(d,b);a(f)}catch(ea){k(ea)}}:k});f.a.g=a;Ka(a,f);return f.a}L.prototype.j=function(a){this.a=M;N(this,O,a)};L.prototype.l=function(a){this.a=M;N(this,P,a)};
function N(a,b,c){if(a.a==M){if(a==c)b=P,c=new TypeError("Promise cannot resolve to itself");else{var d;if(c)try{d=!!c.$goog_Thenable}catch(f){d=!1}else d=!1;if(d){a.a=1;Ia(c,a.j,a.l,a);return}d=typeof c;if("object"==d&&null!=c||"function"==d)try{var l=c.then;if(g(l)){Ma(a,c,l);return}}catch(k){b=P,c=k}}a.i=c;a.a=b;a.g=null;La(a);b!=P||Na(a,c)}}function Ma(a,b,c){function d(b){l||(l=!0,a.l(b))}function f(b){l||(l=!0,a.j(b))}a.a=1;var l=!1;try{c.call(b,f,d)}catch(k){d(k)}}
function La(a){a.h||(a.h=!0,Aa(a.m,a))}function Oa(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.c=null);return b}L.prototype.m=function(){for(var a=null;a=Oa(this);){var b=this.a,c=this.i;if(b==P&&a.b&&!a.g)for(var d=void 0,d=this;d&&d.f;d=d.g)d.f=!1;if(a.a)a.a.g=null,Pa(a,b,c);else try{a.g?a.f.call(a.c):Pa(a,b,c)}catch(f){Qa.call(null,f)}ka(Fa,a)}this.h=!1};function Pa(a,b,c){b==O?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Na(a,b){a.f=!0;Aa(function(){a.f&&Qa.call(null,b)})}
var Qa=wa;var Ra="undefined"!==typeof Promise;function Q(a){return Ra?new Promise(a):new L(a)}function Sa(a){return Ra?Promise.resolve(a):a instanceof L?a:new L(Da,a)}function Ta(a){return Ra?Promise.all(a):Ha(a)};var Ua=z?require("firebase"):Firebase;function Va(a,b){return Q(function(c,d){if(void 0!==b)var f=a.push(b,function(a){a?d(a):c(f)});else c(a.push())})}function Wa(a,b){return Q(function(c,d){a.set(b,function(a){a?d(a):c()})})}function Xa(a,b){return Q(function(c,d){a.update(b,function(a){a?d(a):c()})})}function Ya(a,b){return Q(function(c,d){a.transaction(b,function(a,b,k){a?d(a):c({isCommitted:b,snapshot:k})},!1)})}function Za(a){return Q(function(b,c){a.remove(function(a){a?c(a):b()})})}
function $a(a,b){return Q(function(c,d){a.once(b,function(a){c(a)},function(a){d(a)})})}function ab(a,b,c){return Q(function(d,f){a.authWithCustomToken(b,function(a,b){a?f(a):d(b)},c)})}function bb(a,b){return Q(function(c,d){a.authAnonymously(function(a,b){a?d(a):c(b)},b)})}function cb(a,b,c){return Q(function(d,f){a.authWithPassword(b,function(a,b){a?f(a):d(b)},c)})}function db(a,b,c){return Q(function(d,f){a.authWithOAuthPopup(b,function(a,b){a?f(a):d(b)},c)})}
function eb(a,b,c){return Q(function(d,f){a.authWithOAuthRedirect(b,function(a){f(a)},c)})}function fb(a,b,c,d){return Q(function(f,l){a.authWithOAuthToken(b,c,function(a,b){a?l(a):f(b)},d)})}function gb(a,b){return Q(function(c,d){a.createUser(b,function(a,b){a?d(a):c(b)})})}function hb(a,b){return Q(function(c,d){a.changeEmail(b,function(a){a?d(a):c()})})}function ib(a,b){return Q(function(c,d){a.changePassword(b,function(a){a?d(a):c()})})}
function jb(a,b){return Q(function(c,d){a.removeUser(b,function(a){a?d(a):c()})})}function kb(a,b){return Q(function(c,d){a.resetPassword(b,function(a){a?d(a):c()})})};var lb=E("Opera")||E("OPR"),mb=va(),nb=E("Gecko")&&!(-1!=D.toLowerCase().indexOf("webkit")&&!E("Edge"))&&!(E("Trident")||E("MSIE"))&&!E("Edge"),ob=-1!=D.toLowerCase().indexOf("webkit")&&!E("Edge");function pb(){var a=D;if(nb)return/rv\:([^\);]+)(\)|;)/.exec(a);if(mb&&E("Edge"))return/Edge\/([\d\.]+)/.exec(a);if(mb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ob)return/WebKit\/(\S+)/.exec(a)}
(function(){if(lb&&e.opera){var a=e.opera.version;return g(a)?a():a}var a="",b=pb();b&&(a=b?b[1]:"");return mb&&!E("Edge")&&(b=(b=e.document)?b.documentMode:void 0,b>parseFloat(a))?String(b):a})();var qb=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function rb(a){if(sb){sb=!1;var b=e.location;if(b){var c=b.href;if(c&&(c=(c=rb(c)[3]||null)?decodeURI(c):c)&&c!=b.hostname)throw sb=!0,Error();}}return a.match(qb)}var sb=ob;
function tb(a,b){for(var c=a.split("&"),d=0;d<c.length;d++){var f=c[d].indexOf("="),l=null,k=null;0<=f?(l=c[d].substring(0,f),k=c[d].substring(f+1)):l=c[d];b(l,k?decodeURIComponent(k.replace(/\+/g," ")):"")}};function R(a,b){this.f=this.j=this.b="";this.i=null;this.h=this.c="";this.a=!1;var c;a instanceof R?(this.a=void 0!==b?b:a.a,ub(this,a.b),this.j=a.j,this.f=a.f,vb(this,a.i),this.c=a.c,wb(this,a.g.clone()),this.h=a.h):a&&(c=rb(String(a)))?(this.a=!!b,ub(this,c[1]||"",!0),this.j=S(c[2]||""),this.f=S(c[3]||"",!0),vb(this,c[4]),this.c=S(c[5]||"",!0),wb(this,c[6]||"",!0),this.h=S(c[7]||"")):(this.a=!!b,this.g=new T(null,0,this.a))}
R.prototype.toString=function(){var a=[],b=this.b;b&&a.push(U(b,xb,!0),":");if(b=this.f){a.push("//");var c=this.j;c&&a.push(U(c,xb,!0),"@");a.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.i;null!=b&&a.push(":",String(b))}if(b=this.c)this.f&&"/"!=b.charAt(0)&&a.push("/"),a.push(U(b,"/"==b.charAt(0)?yb:zb,!0));(b=this.g.toString())&&a.push("?",b);(b=this.h)&&a.push("#",U(b,Ab));return a.join("")};R.prototype.clone=function(){return new R(this)};
function ub(a,b,c){a.b=c?S(b,!0):b;a.b&&(a.b=a.b.replace(/:$/,""))}function vb(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.i=b}else a.i=null}function wb(a,b,c){b instanceof T?(a.g=b,Bb(a.g,a.a)):(c||(b=U(b,Cb)),a.g=new T(b,0,a.a))}function S(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function U(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,Db),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}
function Db(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var xb=/[#\/\?@]/g,zb=/[\#\?:]/g,yb=/[\#\?]/g,Cb=/[\#\?@]/g,Ab=/#/g;function T(a,b,c){this.c=this.a=null;this.b=a||null;this.f=!!c}function V(a){a.a||(a.a=new F,a.c=0,a.b&&tb(a.b,function(b,c){var d=decodeURIComponent(b.replace(/\+/g," "));V(a);a.b=null;var d=W(a,d),f=I(a.a,d);f||G(a.a,d,f=[]);f.push(c);a.c++}))}
function Eb(a,b){V(a);b=W(a,b);if(H(a.a.b,b)){a.b=null;a.c-=I(a.a,b).length;var c=a.a;H(c.b,b)&&(delete c.b[b],c.c--,c.f++,c.a.length>2*c.c&&za(c))}}T.prototype.clear=function(){this.a=this.b=null;this.c=0};T.prototype.G=function(){V(this);for(var a=this.a.H(),b=this.a.G(),c=[],d=0;d<b.length;d++)for(var f=a[d],l=0;l<f.length;l++)c.push(b[d]);return c};
T.prototype.H=function(a){V(this);var b=[];if("string"==typeof a){var c=a;V(this);c=W(this,c);H(this.a.b,c)&&(b=na(b,I(this.a,W(this,a))))}else for(a=this.a.H(),c=0;c<a.length;c++)b=na(b,a[c]);return b};T.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";for(var a=[],b=this.a.G(),c=0;c<b.length;c++)for(var d=b[c],f=encodeURIComponent(String(d)),d=this.H(d),l=0;l<d.length;l++){var k=f;""!==d[l]&&(k+="="+encodeURIComponent(String(d[l])));a.push(k)}return this.b=a.join("&")};
T.prototype.clone=function(){var a=new T;a.b=this.b;this.a&&(a.a=this.a.clone(),a.c=this.c);return a};function W(a,b){var c=String(b);a.f&&(c=c.toLowerCase());return c}function Bb(a,b){b&&!a.f&&(V(a),a.b=null,a.a.forEach(function(a,b){var f=b.toLowerCase();if(b!=f&&(Eb(this,b),Eb(this,f),0<a.length)){this.b=null;var l=this.a,f=W(this,f),k;k=a.length;if(0<k){for(var t=Array(k),y=0;y<k;y++)t[y]=a[y];k=t}else k=[];G(l,f,k);this.c+=a.length}},a));a.f=b};function X(a){"string"===typeof a&&(a=z?new Ua(a):new Firebase(a));this.a=a}m("onfire.Ref",X);X.prototype.authWithCustomToken=function(a,b){return ab(this.a,a,b)};X.prototype.authWithCustomToken=X.prototype.authWithCustomToken;X.prototype.A=function(a){return bb(this.a,a)};X.prototype.authAnonymously=X.prototype.A;X.prototype.F=function(a,b){return cb(this.a,a,b)};X.prototype.authWithPassword=X.prototype.F;X.prototype.B=function(a,b){return db(this.a,a,b)};X.prototype.authWithOAuthPopup=X.prototype.B;
X.prototype.C=function(a,b){return eb(this.a,a,b)};X.prototype.authWithOAuthRedirect=X.prototype.C;X.prototype.D=function(a,b,c){return fb(this.a,a,b,c)};X.prototype.authWithOAuthToken=X.prototype.D;X.prototype.I=function(a){return hb(this.a,a)};X.prototype.changeEmail=X.prototype.I;X.prototype.J=function(a){return ib(this.a,a)};X.prototype.changePassword=X.prototype.J;X.prototype.K=function(a){return gb(this.a,a)};X.prototype.createUser=X.prototype.K;X.prototype.L=function(){return this.a.getAuth()};
X.prototype.getAuth=X.prototype.L;X.prototype.N=function(){this.a.goOnline()};X.prototype.goOnline=X.prototype.N;X.prototype.M=function(){this.a.goOffline()};X.prototype.goOffline=X.prototype.M;X.prototype.P=function(a,b){this.a.onAuth(a,b)};X.prototype.onAuth=X.prototype.P;X.prototype.O=function(a,b){this.a.offAuth(a,b)};X.prototype.offAuth=X.prototype.O;X.prototype.Y=function(){this.a.unauth()};X.prototype.unauth=X.prototype.Y;X.prototype.f=function(a){return new X(this.a.child(a))};
X.prototype.child=X.prototype.f;X.prototype.i=function(){return this.a.push().key()};X.prototype.generateId=X.prototype.i;X.prototype.m=function(){return this.a.key()};X.prototype.key=X.prototype.m;X.prototype.h=function(a,b){this.a.off(a,b)};X.prototype.off=X.prototype.h;X.prototype.w=function(a){this.h("value",a)};X.prototype.offValue=X.prototype.w;
X.prototype.g=function(a,b,c,d){var f=this;return this.a.on(a,function(c,k){A(a.toUpperCase()+" at "+f.b(),c.val());b.call(d,c,k)},function(b){C(a.toUpperCase()+" CANCELLED at "+f.b(),b);"function"===typeof c&&c.call(d,b)})};X.prototype.on=X.prototype.g;
X.prototype.s=function(a){A("ONCE "+a.toUpperCase()+" "+this.b());var b=this;return $a(this.a,a).then(function(c){A("ONCE "+a.toUpperCase()+" (Success) "+b.b(),c.val());return c},function(c){C("ONCE "+a.toUpperCase()+" (Failure) "+b.b(),c);throw c;})};X.prototype.once=X.prototype.s;X.prototype.l=function(){return this.s("value").then(function(a){return a.val()})};X.prototype.onceValue=X.prototype.l;X.prototype.j=function(a,b,c){return this.g("value",function(b){a.call(c,b.val())},b,c)};
X.prototype.onValue=X.prototype.j;X.prototype.R=function(){var a=this.a.parent();return a?new X(a):null};X.prototype.parent=X.prototype.R;X.prototype.b=function(){var a;if(!(a=this.c)){a=decodeURIComponent;var b=this.a.toString(),b=(b instanceof R?b.clone():new R(b,void 0)).c;a=this.c=a(b)||"/"}return a};X.prototype.path=X.prototype.b;
X.prototype.push=function(a){A("PUSH "+this.b()+" :",a);var b=this;return Va(this.a,a).then(function(c){A("PUSH (Success) "+b.b()+" :",a);return new X(c)},function(c){C("PUSH (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.push=X.prototype.push;X.prototype.S=function(){return this.a};X.prototype.ref=X.prototype.S;
X.prototype.T=function(){A("REMOVE "+this.b());var a=this;return Za(this.a).then(function(){A("REMOVE (Success) "+a.b());return null},function(b){C("REMOVE (Failure) "+a.b(),b);throw b;})};X.prototype.remove=X.prototype.T;X.prototype.U=function(a){return jb(this.a,a)};X.prototype.removeUser=X.prototype.U;X.prototype.V=function(a){return kb(this.a,a)};X.prototype.resetPassword=X.prototype.V;X.prototype.W=function(){return new X(this.a.root())};X.prototype.root=X.prototype.W;
X.prototype.X=function(a){A("SET "+this.b()+" :",a);var b=this;return Wa(this.a,a).then(function(){A("SET (Success) "+b.b()+" :",a);return null},function(c){C("SET (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.set=X.prototype.X;X.prototype.u=function(a){A("TRANSACTION at "+this.b());var b=this;return Ya(this.a,a).then(function(a){A("TRANSACTION "+(a.isCommitted?"Committed":"Not Committed")+" at "+b.b()+" :",a.snapshot.val());return a},function(a){C("TRANSACTION Failed at "+b.b());throw a;})};
X.prototype.transaction=X.prototype.u;X.prototype.v=function(a){A("UPDATE "+this.b()+" :",a);var b=this;return Xa(this.a,a).then(function(){A("UPDATE (Success) "+b.b()+" :",a);return null},function(c){C("UPDATE (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.update=X.prototype.v;function Y(a){if(!(a instanceof X))throw Error("Invalid ref argument - it must be an onfire.Ref instance");this.b=a;this.s={};this.l=!1;this.h=0;this.f=null;this.D=[];this.v=[];this.o=this.K()}m("onfire.model.Model",Y);Y.prototype.u=function(){A("DISPOSE  "+this.b.b()+" ...");delete this.o;for(var a=0;a<this.v.length;a++)this.b.h.apply(this.b,this.v[a]);this.F=null;for(a=0;a<this.D.length;a++)this.D[a].u();A("DISPOSED "+this.b.b())};Y.prototype.dispose=Y.prototype.u;
function Fb(a,b){a.f=b;var c=[],d;for(d in a.f){var f;switch(p(a.f[d])){case v:case w:case x:break;case u:case r:f=a[d+"Ctor_"];a[d+"Inst_"]=new f(a.b.f(d));c.push(a[d+"Inst_"].o);a.D.push(a[d+"Inst_"]);break;default:throw new TypeError("Invalid property type for "+d);}}a.o=a.o.then(function(){return Ta(c)}).then(function(){a.a=!0;return a});a.a=!1}
Y.prototype.K=function(){var a=this;return Q(function(b,c){a.a=!1;var d=a.b.j(function(c){var d=a.a;Gb(a,c);d||b(a)},function(b){a.a||c(b)});a.v.push(["value",d])})};Y.prototype.$=function(){return this.o};Y.prototype.whenLoaded=Y.prototype.$;Y.prototype.Y=function(){return this.b.m()};Y.prototype.key=Y.prototype.Y;Y.prototype.X=function(){if(!this.a)throw Error("Not loaded yet");return!!this.c};Y.prototype.exists=Y.prototype.X;Y.prototype.S=function(a){this.F=a};Y.prototype.onValueChanged=Y.prototype.S;
function Gb(a,b){a.c=b;a.h=la(b).length;a.a=!0;a.F&&a.F.call(null)}Y.prototype.w=function(a){return a in this.f&&"string"!==typeof this.f[a]?this.j(a):this.i(a)};Y.prototype.get=Y.prototype.w;Y.prototype.i=function(a){if(!this.a)throw Error("Not loaded yet");if(this.c&&a in this.c)return this.c[a];if(a in this.f)return null;throw Error("No such key");};Y.prototype.getBasicValue=Y.prototype.i;
Y.prototype.j=function(a){if(!this.a)throw Error("Not loaded yet");if(!(a in this.f))throw Error("No such key");if("string"===typeof this.f[a])throw Error("Not a model");return this[a+"Inst_"]};Y.prototype.getModel=Y.prototype.j;Y.prototype.A=function(a,b){if(!this.a)throw Error("Not loaded yet");var c=a in this.f,d=this.c&&a in this.c;if(!c&&!d)throw Error("No such key");if(c&&"string"!==typeof this.f[a])throw Error("Not a primitive");this.s[a]=b;this.l=!0;return this};Y.prototype.set=Y.prototype.A;
Y.prototype.O=function(){return this.l};Y.prototype.hasChanges=Y.prototype.O;Y.prototype.J=function(){return this.l?Hb(this,this.s).then(function(a){a.s={};a.l=!1;return a}):Sa(this)};Y.prototype.save=Y.prototype.J;function Hb(a,b){var c=a.h;return a.b.v(b).then(function(){0<c&&0===a.h?A("REMOVED "+a.b.b()):0===c&&0<a.h&&A("CREATED "+a.b.b());return a})}function Ib(a,b){return a.b.u(function(a){if(null===a)return b}).then(function(b){b.isCommitted&&A("CREATED "+a.b.b());return b})};function Z(a,b){Y.call(this,a);this.g=b}n(Z,Y);m("onfire.model.Collection",Z);Z.prototype.K=function(){var a=this,b=this.b.l().then(function(b){Gb(a,b);return a});b.then(function(){var b=a.b.g("child_added",a.M,void 0,a),d=a.b.g("child_removed",a.N,void 0,a);a.v.push(["child_added",b,a]);a.v.push(["child_removed",d,a])});return b};Z.prototype.u=function(){Z.aa.u.call(this);this.C=this.B=null};Z.prototype.dispose=Z.prototype.u;Z.prototype.w=function(a){return this.g?this.j(a):this.i(a)};
Z.prototype.get=Z.prototype.w;Z.prototype.j=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");if(!this.m(a))throw Error("No such key");return new this.g(this.b.f(a))};Z.prototype.getModel=Z.prototype.j;Z.prototype.i=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.m(a))throw Error("No such key");return this.c[a]};Z.prototype.getBasicValue=Z.prototype.i;
Z.prototype.A=function(a,b){if(!this.a)throw Error("Not loaded yet");if(this.g)throw Error("Not a primitive");this.s[a]=b;this.l=!0;return this};Z.prototype.set=Z.prototype.A;Z.prototype.I=function(a){return this.j(a).o};Z.prototype.fetch=Z.prototype.I;Z.prototype.U=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");var b=this.b.i(),b=(new this.g(this.b.f(b))).o;a&&(b=b.then(function(b){return Hb(b,a)}));return b};Z.prototype.create=Z.prototype.U;
Z.prototype.L=function(a,b){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");return(new this.g(this.b.f(a))).o.then(function(a){return b?Ib(a,b).then(function(){return a}):a})};Z.prototype.fetchOrCreate=Z.prototype.L;Z.prototype.W=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.m(a))return Sa(null);this.s[a]=null;this.l=!0;return this.J().then(function(){return null})};Z.prototype.remove=Z.prototype.W;
Z.prototype.forEach=function(a){if(!this.a)throw Error("Not loaded yet");var b=[],c;for(c in this.c){var d=this.g?this.I(c):Sa(this.i(c)),d=d.then(function(b){return a.call(null,b,c)});b.push(d)}return Ta(b)};Z.prototype.forEach=Z.prototype.forEach;Z.prototype.T=function(){if(!this.a)throw Error("Not loaded yet");return this.h};Z.prototype.count=Z.prototype.T;Z.prototype.m=function(a){if(!this.a)throw Error("Not loaded yet");return!!this.c&&a in this.c};Z.prototype.containsKey=Z.prototype.m;
Z.prototype.V=function(){if(!this.a)throw Error("Not loaded yet");return la(this.c)};Z.prototype.keys=Z.prototype.V;Z.prototype.P=function(a){this.B=a};Z.prototype.onChildAdded=Z.prototype.P;Z.prototype.R=function(a){this.C=a};Z.prototype.onChildRemoved=Z.prototype.R;Z.prototype.M=function(a){this.c||(this.c={});var b=a.key(),c=!this.m(b);this.c[b]=a.val();c&&(this.h++,this.B&&this.B.call(null,a.key()))};
Z.prototype.N=function(a){var b=a.key();this.m(b)&&(delete this.c[b],this.h--,0===this.h&&(this.c=null),this.C&&this.C.call(null,a.key()))};function Jb(a){switch(typeof a){case "function":return a;case "object":break;default:throw Error("Invalid schema - it must be an object or a constructor!");}return p(a)===r?Kb(a):Lb(a)}function Lb(a){function b(b){Y.call(this,b);Fb(this,a)}n(b,Y);Mb(b,a);return b}function Kb(a){function b(a){Z.call(this,a,c)}a=a.$id;var c;switch(p(a)){case q:c=a;break;case u:case r:c=Lb(a)}n(b,Z);return b}
function Mb(a,b){for(var c in b){var d=b[c];switch(p(d)){case v:case w:case x:void 0===a.prototype[c]?a.prototype[c]=Nb(c):ha(c+" clashes with a built-in property or method. Use the generic .get("+c+") / .set("+c+", value) methods to access this property.");break;case q:case u:case r:a.prototype[c+"Ctor_"]=Jb(d);void 0===a.prototype[c]?a.prototype[c]=Ob(c):ha(c+" clashes with a built-in property or method. Use the generic .getModel("+c+") method to access this property.");break;default:throw new TypeError("Invalid property type for "+
c);}}}function Nb(a){return function(b){return 0===arguments.length?this.w(a):this.A(a,b)}}function Ob(a){return function(){return this.w(a)}};m("onfire.defineModel",Jb);z&&(module.exports=e.onfire);})();//# sourceMappingURL=./onfire.min.js.map
