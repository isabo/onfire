/**
 * OnFire
 * Copyright (c) 2013 - 2015 Itzy Sabo
 * Licensed under the MIT License: https://github.com/isabo/onfire/blob/master/LICENSE
 */
(function(){var e,g=this;function h(){}
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function m(a){return"function"==aa(a)}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function n(a,b,c){n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return n.apply(null,arguments)}function da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function p(a,b){var c=a.split("."),d=g;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)c.length||void 0===b?d[f]?d=d[f]:d=d[f]={}:d[f]=b}
function q(a,b){function c(){}c.prototype=b.prototype;a.R=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.V=function(a,c,k){for(var l=Array(arguments.length-2),r=2;r<arguments.length;r++)l[r-2]=arguments[r];return b.prototype[c].apply(a,l)}};p("onfire.model.Error",{INVALID_REF:"Invalid ref argument - it must be an onfire.Ref instance",NOT_LOADED:"Not loaded yet",NO_SUCH_KEY:"No such key",NOT_A_MODEL:"Not a model",NOT_A_PRIMITIVE:"Not a primitive"});function t(a){switch(typeof a){case "function":return u;case "object":return void 0!==a.$id?v:w}switch(a){case "string":return x;case "number":return y;case "boolean":return z;default:return fa}}var x=0,y=1,z=2,w=3,v=4,u=5,fa=-1;var A="undefined"!==typeof module&&module!==this.module&&!!module.exports;function B(a){C("info",arguments)}function ga(a){C("warn",arguments)}function D(a){C("error",arguments)}function C(a,b){var c=Array.prototype.slice.call(b,0);c.unshift("ONFIRE:");"function"===typeof console[a]?console[a].apply(console,c):console.log.apply(console,c)};function E(a,b,c){this.f=c;this.c=a;this.g=b;this.b=0;this.a=null}E.prototype.get=function(){var a;0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c();return a};function ha(a,b){a.g(b);a.b<a.f&&(a.b++,b.next=a.a,a.a=b)};function F(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}var ia="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ja(a,b){for(var c,d,f=1;f<arguments.length;f++){d=arguments[f];for(c in d)a[c]=d[c];for(var k=0;k<ia.length;k++)c=ia[k],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var ka=Array.prototype;function la(a){return ka.concat.apply(ka,arguments)}function ma(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};function na(){this.b=this.a=null}var pa=new E(function(){return new oa},function(a){a.reset()},100);na.prototype.remove=function(){var a=null;this.a&&(a=this.a,this.a=this.a.next,this.a||(this.b=null),a.next=null);return a};function oa(){this.next=this.b=this.a=null}oa.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};oa.prototype.reset=function(){this.next=this.b=this.a=null};var G;a:{var qa=g.navigator;if(qa){var ra=qa.userAgent;if(ra){G=ra;break a}}G=""};function sa(a){g.setTimeout(function(){throw a;},0)}var ta;
function ua(){var a=g.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&-1==G.indexOf("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=n(function(a){if(("*"==d||a.origin==
d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&-1==G.indexOf("Trident")&&-1==G.indexOf("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.F;c.F=null;a()}};return function(a){d.next={F:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=
document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){g.setTimeout(a,0)}};function va(a,b){H||wa();xa||(H(),xa=!0);var c=ya,d=pa.get();d.set(a,b);c.b?c.b.next=d:c.a=d;c.b=d}var H;function wa(){if(g.Promise&&g.Promise.resolve){var a=g.Promise.resolve(void 0);H=function(){a.then(za)}}else H=function(){var a=za;!m(g.setImmediate)||g.Window&&g.Window.prototype&&g.Window.prototype.setImmediate==g.setImmediate?(ta||(ta=ua()),ta(a)):g.setImmediate(a)}}var xa=!1,ya=new na;function za(){for(var a=null;a=ya.remove();){try{a.a.call(a.b)}catch(b){sa(b)}ha(pa,a)}xa=!1};function I(a,b){this.a=J;this.i=void 0;this.c=this.b=this.g=null;this.f=this.h=!1;if(a!=h)try{var c=this;a.call(b,function(a){K(c,M,a)},function(a){try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}K(c,N,a)})}catch(d){K(this,N,d)}}var J=0,M=2,N=3;function Aa(){this.next=this.b=this.a=this.c=this.child=null;this.f=!1}Aa.prototype.reset=function(){this.b=this.a=this.c=this.child=null;this.f=!1};var Ba=new E(function(){return new Aa},function(a){a.reset()},100);
function Ca(a,b,c){var d=Ba.get();d.c=a;d.a=b;d.b=c;return d}function Da(a,b,c){Ea(a,b,c,null)||va(da(b,a))}function Fa(a){return new I(function(b,c){var d=a.length,f=[];if(d)for(var k=function(a,c){d--;f[a]=c;0==d&&b(f)},l=function(a){c(a)},r=0,L;r<a.length;r++)L=a[r],Da(L,da(k,r),l);else b(f)})}I.prototype.then=function(a,b,c){return Ga(this,m(a)?a:null,m(b)?b:null,c)};I.prototype.then=I.prototype.then;I.prototype.$goog_Thenable=!0;
function Ha(a,b){a.b||a.a!=M&&a.a!=N||Ia(a);a.c?a.c.next=b:a.b=b;a.c=b}function Ga(a,b,c,d){var f=Ca(null,null,null);f.child=new I(function(a,l){f.c=b?function(c){try{var f=b.call(d,c);a(f)}catch(ea){l(ea)}}:a;f.a=c?function(b){try{var f=c.call(d,b);a(f)}catch(ea){l(ea)}}:l});f.child.g=a;Ha(a,f);return f.child}I.prototype.A=function(a){this.a=J;K(this,M,a)};I.prototype.B=function(a){this.a=J;K(this,N,a)};
function K(a,b,c){a.a==J&&(a==c&&(b=N,c=new TypeError("Promise cannot resolve to itself")),a.a=1,Ea(c,a.A,a.B,a)||(a.i=c,a.a=b,a.g=null,Ia(a),b!=N||Ja(a,c)))}function Ea(a,b,c,d){if(a instanceof I)return Ha(a,Ca(b||h,c||null,d)),!0;var f;if(a)try{f=!!a.$goog_Thenable}catch(l){f=!1}else f=!1;if(f)return a.then(b,c,d),!0;f=typeof a;if("object"==f&&null!=a||"function"==f)try{var k=a.then;if(m(k))return Ka(a,k,b,c,d),!0}catch(l){return c.call(d,l),!0}return!1}
function Ka(a,b,c,d,f){function k(a){r||(r=!0,d.call(f,a))}function l(a){r||(r=!0,c.call(f,a))}var r=!1;try{b.call(a,l,k)}catch(L){k(L)}}function Ia(a){a.h||(a.h=!0,va(a.l,a))}function La(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.c=null);return b}
I.prototype.l=function(){for(var a=null;a=La(this);){var b=this.a,c=this.i;if(b==N&&a.a&&!a.f)for(var d=void 0,d=this;d&&d.f;d=d.g)d.f=!1;if(a.child)a.child.g=null,Ma(a,b,c);else try{a.f?a.c.call(a.b):Ma(a,b,c)}catch(f){Na.call(null,f)}ha(Ba,a)}this.h=!1};function Ma(a,b,c){b==M?a.c.call(a.b,c):a.a&&a.a.call(a.b,c)}function Ja(a,b){a.f=!0;va(function(){a.f&&Na.call(null,b)})}var Na=sa;var Oa="undefined"!==typeof Promise;function O(a){return Oa?new Promise(a):new I(a)}function Pa(a){if(Oa)a=Promise.resolve(a);else if(!(a instanceof I)){var b=new I(h);K(b,M,a);a=b}return a}function Qa(a){return Oa?Promise.all(a):Fa(a)};var Ra=A?require("firebase"):Firebase;function Sa(a,b){return O(function(c,d){if(void 0!==b)var f=a.push(b,function(a){a?d(a):c(f)});else c(a.push())})}function Ta(a,b){return O(function(c,d){a.set(b,function(a){a?d(a):c()})})}function Ua(a,b){return O(function(c,d){a.update(b,function(a){a?d(a):c()})})}function Va(a,b){return O(function(c,d){a.transaction(b,function(a,b,l){a?d(a):c({isCommitted:b,snapshot:l})},!1)})}function Wa(a){return O(function(b,c){a.remove(function(a){a?c(a):b()})})}
function Xa(a,b){return O(function(c,d){a.once(b,function(a){c(a)},function(a){d(a)})})}function Ya(a,b,c){return O(function(d,f){a.authWithCustomToken(b,function(a,b){a?f(a):d(b)},c)})}function Za(a,b){return O(function(c,d){a.authAnonymously(function(a,b){a?d(a):c(b)},b)})}function $a(a,b,c){return O(function(d,f){a.authWithPassword(b,function(a,b){a?f(a):d(b)},c)})}function ab(a,b,c){return O(function(d,f){a.authWithOAuthPopup(b,function(a,b){a?f(a):d(b)},c)})}
function bb(a,b,c){return O(function(d,f){a.authWithOAuthRedirect(b,function(a){f(a)},c)})}function cb(a,b,c,d){return O(function(f,k){a.authWithOAuthToken(b,c,function(a,b){a?k(a):f(b)},d)})}function db(a,b){return O(function(c,d){a.createUser(b,function(a,b){a?d(a):c(b)})})}function eb(a,b){return O(function(c,d){a.changeEmail(b,function(a){a?d(a):c()})})}function fb(a,b){return O(function(c,d){a.changePassword(b,function(a){a?d(a):c()})})}
function gb(a,b){return O(function(c,d){a.removeUser(b,function(a){a?d(a):c()})})}function hb(a,b){return O(function(c,d){a.resetPassword(b,function(a){a?d(a):c()})})};function P(a,b){this.b={};this.a=[];this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){if(a instanceof P)c=a.w(),d=a.u();else{var c=F(a),f=[],k=0;for(d in a)f[k++]=a[d];d=f}for(f=0;f<c.length;f++)this.set(c[f],d[f])}}e=P.prototype;e.u=function(){ib(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};e.w=function(){ib(this);return this.a.concat()};
e.j=function(a){return Q(this.b,a)};e.clear=function(){this.b={};this.c=this.a.length=0};e.remove=function(a){return Q(this.b,a)?(delete this.b[a],this.c--,this.a.length>2*this.c&&ib(this),!0):!1};function ib(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];Q(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){for(var f={},c=b=0;b<a.a.length;)d=a.a[b],Q(f,d)||(a.a[c++]=d,f[d]=1),b++;a.a.length=c}}e.get=function(a,b){return Q(this.b,a)?this.b[a]:b};
e.set=function(a,b){Q(this.b,a)||(this.c++,this.a.push(a));this.b[a]=b};e.forEach=function(a,b){for(var c=this.w(),d=0;d<c.length;d++){var f=c[d],k=this.get(f);a.call(b,k,f,this)}};e.clone=function(){return new P(this)};function Q(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var jb=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function kb(a,b){if(a)for(var c=a.split("&"),d=0;d<c.length;d++){var f=c[d].indexOf("="),k=null,l=null;0<=f?(k=c[d].substring(0,f),l=c[d].substring(f+1)):k=c[d];b(k,l?decodeURIComponent(l.replace(/\+/g," ")):"")}};function R(a,b){this.f=this.l=this.c="";this.i=null;this.h=this.b="";this.a=!1;var c;a instanceof R?(this.a=void 0!==b?b:a.a,lb(this,a.c),this.l=a.l,this.f=a.f,mb(this,a.i),this.b=a.b,nb(this,a.g.clone()),this.h=a.h):a&&(c=String(a).match(jb))?(this.a=!!b,lb(this,c[1]||"",!0),this.l=S(c[2]||""),this.f=S(c[3]||"",!0),mb(this,c[4]),this.b=S(c[5]||"",!0),nb(this,c[6]||"",!0),this.h=S(c[7]||"")):(this.a=!!b,this.g=new T(null,0,this.a))}
R.prototype.toString=function(){var a=[],b=this.c;b&&a.push(U(b,ob,!0),":");var c=this.f;if(c||"file"==b)a.push("//"),(b=this.l)&&a.push(U(b,ob,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.i,null!=c&&a.push(":",String(c));if(c=this.b)this.f&&"/"!=c.charAt(0)&&a.push("/"),a.push(U(c,"/"==c.charAt(0)?pb:qb,!0));(c=this.g.toString())&&a.push("?",c);(c=this.h)&&a.push("#",U(c,rb));return a.join("")};R.prototype.clone=function(){return new R(this)};
function lb(a,b,c){a.c=c?S(b,!0):b;a.c&&(a.c=a.c.replace(/:$/,""))}function mb(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.i=b}else a.i=null}function nb(a,b,c){b instanceof T?(a.g=b,sb(a.g,a.a)):(c||(b=U(b,tb)),a.g=new T(b,0,a.a))}function S(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function U(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,ub),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}
function ub(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var ob=/[#\/\?@]/g,qb=/[\#\?:]/g,pb=/[\#\?]/g,tb=/[\#\?@]/g,rb=/#/g;function T(a,b,c){this.c=this.a=null;this.b=a||null;this.f=!!c}function V(a){a.a||(a.a=new P,a.c=0,a.b&&kb(a.b,function(b,c){var d=decodeURIComponent(b.replace(/\+/g," "));V(a);a.b=null;var d=W(a,d),f=a.a.get(d);f||a.a.set(d,f=[]);f.push(c);a.c++}))}e=T.prototype;
e.remove=function(a){V(this);a=W(this,a);return this.a.j(a)?(this.b=null,this.c-=this.a.get(a).length,this.a.remove(a)):!1};e.clear=function(){this.a=this.b=null;this.c=0};e.j=function(a){V(this);a=W(this,a);return this.a.j(a)};e.w=function(){V(this);for(var a=this.a.u(),b=this.a.w(),c=[],d=0;d<b.length;d++)for(var f=a[d],k=0;k<f.length;k++)c.push(b[d]);return c};
e.u=function(a){V(this);var b=[];if("string"==typeof a)this.j(a)&&(b=la(b,this.a.get(W(this,a))));else{a=this.a.u();for(var c=0;c<a.length;c++)b=la(b,a[c])}return b};e.set=function(a,b){V(this);this.b=null;a=W(this,a);this.j(a)&&(this.c-=this.a.get(a).length);this.a.set(a,[b]);this.c++;return this};e.get=function(a,b){var c=a?this.u(a):[];return 0<c.length?String(c[0]):b};
e.toString=function(){if(this.b)return this.b;if(!this.a)return"";for(var a=[],b=this.a.w(),c=0;c<b.length;c++)for(var d=b[c],f=encodeURIComponent(String(d)),d=this.u(d),k=0;k<d.length;k++){var l=f;""!==d[k]&&(l+="="+encodeURIComponent(String(d[k])));a.push(l)}return this.b=a.join("&")};e.clone=function(){var a=new T;a.b=this.b;this.a&&(a.a=this.a.clone(),a.c=this.c);return a};function W(a,b){var c=String(b);a.f&&(c=c.toLowerCase());return c}
function sb(a,b){b&&!a.f&&(V(a),a.b=null,a.a.forEach(function(a,b){var f=b.toLowerCase();b!=f&&(this.remove(b),this.remove(f),0<a.length&&(this.b=null,this.a.set(W(this,f),ma(a)),this.c+=a.length))},a));a.f=b};function X(a){"string"===typeof a&&(a=A?new Ra(a):new Firebase(a));this.a=a}p("onfire.Ref",X);X.prototype.authWithCustomToken=function(a,b){return Ya(this.a,a,b)};X.prototype.authWithCustomToken=X.prototype.authWithCustomToken;X.prototype.authAnonymously=function(a){return Za(this.a,a)};X.prototype.authAnonymously=X.prototype.authAnonymously;X.prototype.authWithPassword=function(a,b){return $a(this.a,a,b)};X.prototype.authWithPassword=X.prototype.authWithPassword;
X.prototype.authWithOAuthPopup=function(a,b){return ab(this.a,a,b)};X.prototype.authWithOAuthPopup=X.prototype.authWithOAuthPopup;X.prototype.authWithOAuthRedirect=function(a,b){return bb(this.a,a,b)};X.prototype.authWithOAuthRedirect=X.prototype.authWithOAuthRedirect;X.prototype.authWithOAuthToken=function(a,b,c){return cb(this.a,a,b,c)};X.prototype.authWithOAuthToken=X.prototype.authWithOAuthToken;X.prototype.changeEmail=function(a){return eb(this.a,a)};X.prototype.changeEmail=X.prototype.changeEmail;
X.prototype.changePassword=function(a){return fb(this.a,a)};X.prototype.changePassword=X.prototype.changePassword;X.prototype.createUser=function(a){return db(this.a,a)};X.prototype.createUser=X.prototype.createUser;X.prototype.getAuth=function(){return this.a.getAuth()};X.prototype.getAuth=X.prototype.getAuth;X.prototype.goOnline=function(){this.a.goOnline()};X.prototype.goOnline=X.prototype.goOnline;X.prototype.goOffline=function(){this.a.goOffline()};X.prototype.goOffline=X.prototype.goOffline;
X.prototype.onAuth=function(a,b){this.a.onAuth(a,b)};X.prototype.onAuth=X.prototype.onAuth;X.prototype.offAuth=function(a,b){this.a.offAuth(a,b)};X.prototype.offAuth=X.prototype.offAuth;X.prototype.unauth=function(){this.a.unauth()};X.prototype.unauth=X.prototype.unauth;X.prototype.child=function(a){a=this.a.child(a);return new X(a)};X.prototype.child=X.prototype.child;X.prototype.G=function(){return this.a.push().key()};X.prototype.generateId=X.prototype.G;X.prototype.key=function(){return this.a.key()};
X.prototype.key=X.prototype.key;X.prototype.off=function(a,b){this.a.off(a,b)};X.prototype.off=X.prototype.off;X.prototype.M=function(a,b){this.off("value",a,b)};X.prototype.offValue=X.prototype.M;X.prototype.on=function(a,b,c,d){var f=this;return this.a.on(a,function(c,l){B(a.toUpperCase()+" at "+f.path(),c.val());b.call(d,c,l)},function(b){D(a.toUpperCase()+" CANCELLED at "+f.path(),b);"function"===typeof c&&c.call(d,b)})};X.prototype.on=X.prototype.on;
X.prototype.once=function(a){B("ONCE "+a.toUpperCase()+" "+this.path());var b=this;return Xa(this.a,a).then(function(c){B("ONCE "+a.toUpperCase()+" (Success) "+b.path(),c.val());return c},function(c){D("ONCE "+a.toUpperCase()+" (Failure) "+b.path(),c);throw c;})};X.prototype.once=X.prototype.once;X.prototype.I=function(){return this.once("value").then(function(a){return a.val()})};X.prototype.onceValue=X.prototype.I;
X.prototype.H=function(a,b,c){return this.on("value",function(b){a.call(c,b.val())},b,c)};X.prototype.onValue=X.prototype.H;X.prototype.parent=function(){var a=this.a.parent();return a?new X(a):null};X.prototype.parent=X.prototype.parent;X.prototype.path=function(){var a;if(!(a=this.b)){a=decodeURIComponent;var b=this.a.toString(),b=(b instanceof R?b.clone():new R(b,void 0)).b;a=this.b=a(b)||"/"}return a};X.prototype.path=X.prototype.path;
X.prototype.push=function(a){B("PUSH "+this.path()+" :",a);var b=this;return Sa(this.a,a).then(function(c){B("PUSH (Success) "+b.path()+" :",a);return new X(c)},function(c){D("PUSH (Failure) "+b.path()+" :",a,c);throw c;})};X.prototype.push=X.prototype.push;X.prototype.ref=function(){return this.a};X.prototype.ref=X.prototype.ref;
X.prototype.remove=function(){B("REMOVE "+this.path());var a=this;return Wa(this.a).then(function(){B("REMOVE (Success) "+a.path());return null},function(b){D("REMOVE (Failure) "+a.path(),b);throw b;})};X.prototype.remove=X.prototype.remove;X.prototype.removeUser=function(a){return gb(this.a,a)};X.prototype.removeUser=X.prototype.removeUser;X.prototype.resetPassword=function(a){return hb(this.a,a)};X.prototype.resetPassword=X.prototype.resetPassword;X.prototype.root=function(){return new X(this.a.root())};
X.prototype.root=X.prototype.root;X.prototype.set=function(a){B("SET "+this.path()+" :",a);var b=this;return Ta(this.a,a).then(function(){B("SET (Success) "+b.path()+" :",a);return null},function(c){D("SET (Failure) "+b.path()+" :",a,c);throw c;})};X.prototype.set=X.prototype.set;
X.prototype.transaction=function(a){B("TRANSACTION at "+this.path());var b=this;return Va(this.a,a).then(function(a){B("TRANSACTION "+(a.isCommitted?"Committed":"Not Committed")+" at "+b.path()+" :",a.snapshot.val());return a},function(a){D("TRANSACTION Failed at "+b.path());throw a;})};X.prototype.transaction=X.prototype.transaction;
X.prototype.update=function(a){B("UPDATE "+this.path()+" :",a);var b=this;return Ua(this.a,a).then(function(){B("UPDATE (Success) "+b.path()+" :",a);return null},function(c){D("UPDATE (Failure) "+b.path()+" :",a,c);throw c;})};X.prototype.update=X.prototype.update;function Y(a){if(!(a instanceof X))throw Error("Invalid ref argument - it must be an onfire.Ref instance");this.ref=a;this.i={};this.h=!1;this.g=0;this.c=null;this.C=[];this.l=[];this.m=this.J()}p("onfire.model.Model",Y);Y.prototype.v=function(){B("DISPOSE  "+this.ref.path()+" ...");delete this.m;for(var a=0;a<this.l.length;a++)this.ref.off.apply(this.ref,this.l[a]);this.D=null;for(a=0;a<this.C.length;a++)this.C[a].v();B("DISPOSED "+this.ref.path())};Y.prototype.dispose=Y.prototype.v;
function vb(a,b){a.c=b;var c=[],d;for(d in a.c){var f;switch(t(a.c[d])){case x:case y:case z:break;case w:case v:f=a[d+"Ctor_"];a[d+"Inst_"]=new f(a.ref.child(d));c.push(a[d+"Inst_"].m);a.C.push(a[d+"Inst_"]);break;default:throw new TypeError("Invalid property type for "+d);}}a.m=a.m.then(function(){return Qa(c)}).then(function(){a.a=!0;return a});a.a=!1}
Y.prototype.J=function(){var a=this;return O(function(b,c){a.a=!1;var d=a.ref.H(function(c){var d=a.a;wb(a,c);d||b(a)},function(b){a.a||c(b)});a.l.push(["value",d])})};Y.prototype.U=function(){return this.m};Y.prototype.whenLoaded=Y.prototype.U;Y.prototype.key=function(){return this.ref.key()};Y.prototype.key=Y.prototype.key;Y.prototype.exists=function(){if(!this.a)throw Error("Not loaded yet");return!!this.b};Y.prototype.exists=Y.prototype.exists;Y.prototype.P=function(a){this.D=a};
Y.prototype.onValueChanged=Y.prototype.P;function wb(a,b){a.b=b;a.g=F(b).length;a.a=!0;a.D&&a.D.call(null)}Y.prototype.get=function(a){return a in this.c&&"string"!==typeof this.c[a]?this.s(a):this.o(a)};Y.prototype.get=Y.prototype.get;Y.prototype.o=function(a){if(!this.a)throw Error("Not loaded yet");if(this.b&&a in this.b)return this.b[a];if(a in this.c)return null;throw Error("No such key");};Y.prototype.getBasicValue=Y.prototype.o;
Y.prototype.s=function(a){if(!this.a)throw Error("Not loaded yet");if(!(a in this.c))throw Error("No such key");if("string"===typeof this.c[a])throw Error("Not a model");return this[a+"Inst_"]};Y.prototype.getModel=Y.prototype.s;Y.prototype.set=function(a,b){if(!this.a)throw Error("Not loaded yet");var c=a in this.c,d=this.b&&a in this.b;if(!c&&!d)throw Error("No such key");if(c&&"string"!==typeof this.c[a])throw Error("Not a primitive");this.i[a]=b;this.h=!0;return this};Y.prototype.set=Y.prototype.set;
Y.prototype.L=function(){return this.h};Y.prototype.hasChanges=Y.prototype.L;Y.prototype.save=function(){return this.h?this.update(this.i).then(function(a){a.i={};a.h=!1;return a}):Pa(this)};Y.prototype.save=Y.prototype.save;Y.prototype.update=function(a){var b=this.g,c=this;return this.ref.update(a).then(function(){0<b&&0===c.g?B("REMOVED "+c.ref.path()):0===b&&0<c.g&&B("CREATED "+c.ref.path());return c})};
function xb(a,b){return a.ref.transaction(function(a){if(null===a)return b}).then(function(b){b.isCommitted&&B("CREATED "+a.ref.path());return b})};function Z(a,b){Y.call(this,a);this.f=b}q(Z,Y);p("onfire.model.Collection",Z);Z.prototype.J=function(){var a=this,b=this.ref.I().then(function(b){wb(a,b);return a});b.then(function(){var b=a.ref.on("child_added",a.S,void 0,a),d=a.ref.on("child_removed",a.T,void 0,a);a.l.push(["child_added",b,a]);a.l.push(["child_removed",d,a])});return b};Z.prototype.v=function(){Z.R.v.call(this);this.B=this.A=null};Z.prototype.dispose=Z.prototype.v;Z.prototype.get=function(a){return this.f?this.s(a):this.o(a)};
Z.prototype.get=Z.prototype.get;Z.prototype.s=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.f)throw Error("Not a model");if(!this.j(a))throw Error("No such key");return new this.f(this.ref.child(a))};Z.prototype.getModel=Z.prototype.s;Z.prototype.o=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.j(a))throw Error("No such key");return this.b[a]};Z.prototype.getBasicValue=Z.prototype.o;
Z.prototype.set=function(a,b){if(!this.a)throw Error("Not loaded yet");if(this.f)throw Error("Not a primitive");this.i[a]=b;this.h=!0;return this};Z.prototype.set=Z.prototype.set;Z.prototype.fetch=function(a){return this.s(a).m};Z.prototype.fetch=Z.prototype.fetch;Z.prototype.create=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.f)throw Error("Not a model");var b=this.ref.G(),b=(new this.f(this.ref.child(b))).m;a&&(b=b.then(function(b){return b.update(a)}));return b};
Z.prototype.create=Z.prototype.create;Z.prototype.K=function(a,b){if(!this.a)throw Error("Not loaded yet");if(!this.f)throw Error("Not a model");return(new this.f(this.ref.child(a))).m.then(function(a){return b?xb(a,b).then(function(){return a}):a})};Z.prototype.fetchOrCreate=Z.prototype.K;Z.prototype.remove=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.j(a))return Pa(null);this.i[a]=null;this.h=!0;return this.save().then(function(){return null})};Z.prototype.remove=Z.prototype.remove;
Z.prototype.forEach=function(a){if(!this.a)throw Error("Not loaded yet");var b=[],c;for(c in this.b){var d=this.f?this.fetch(c):Pa(this.o(c)),d=d.then(function(b){return a.call(null,b,c)});b.push(d)}return Qa(b)};Z.prototype.forEach=Z.prototype.forEach;Z.prototype.count=function(){if(!this.a)throw Error("Not loaded yet");return this.g};Z.prototype.count=Z.prototype.count;Z.prototype.j=function(a){if(!this.a)throw Error("Not loaded yet");return!!this.b&&a in this.b};Z.prototype.containsKey=Z.prototype.j;
Z.prototype.keys=function(){if(!this.a)throw Error("Not loaded yet");return F(this.b)};Z.prototype.keys=Z.prototype.keys;Z.prototype.N=function(a){this.A=a};Z.prototype.onChildAdded=Z.prototype.N;Z.prototype.O=function(a){this.B=a};Z.prototype.onChildRemoved=Z.prototype.O;Z.prototype.S=function(a){this.b||(this.b={});var b=a.key(),c=!this.j(b);this.b[b]=a.val();c&&(this.g++,this.A&&this.A.call(null,a.key()))};
Z.prototype.T=function(a){var b=a.key();this.j(b)&&(delete this.b[b],this.g--,0===this.g&&(this.b=null),this.B&&this.B.call(null,a.key()))};function yb(a){switch(typeof a){case "function":return a;case "object":break;default:throw Error("Invalid schema - it must be an object or a constructor!");}return t(a)===v?zb(a):Ab(a)}function Ab(a){function b(b){Y.call(this,b);vb(this,a)}q(b,Y);var c={};ja(c,a);b.getSchema=function(){return c};Bb(b,a);return b}function zb(a){function b(a){Z.call(this,a,d)}var c=a.$id,d;switch(t(c)){case u:d=c;break;case w:case v:d=Ab(c)}q(b,Z);var f={};ja(f,a);b.getSchema=function(){return f};return b}
function Bb(a,b){for(var c in b){var d=b[c];switch(t(d)){case x:case y:case z:void 0===a.prototype[c]?a.prototype[c]=Cb(c):ga(c+" clashes with a built-in property or method. Use the generic .get("+c+") / .set("+c+", value) methods to access this property.");break;case u:case w:case v:a.prototype[c+"Ctor_"]=yb(d);void 0===a.prototype[c]?a.prototype[c]=Db(c):ga(c+" clashes with a built-in property or method. Use the generic .getModel("+c+") method to access this property.");break;default:throw new TypeError("Invalid property type for "+
c);}}}function Cb(a){return function(b){return void 0===b?this.get(a):this.set(a,b)}}function Db(a){return function(){return this.get(a)}};p("onfire.defineModel",yb);A&&(module.exports=g.onfire);})();//# sourceMappingURL=./onfire.min.js.map

