/**
 * OnFire
 * Copyright (c) 2013 - 2015 Itzy Sabo
 * Licensed under the MIT License: https://github.com/isabo/onfire/blob/master/LICENSE
 */
(function(){var e=this;function g(){}
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function h(a){return"function"==aa(a)}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function m(a,b,c){m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return m.apply(null,arguments)}function ea(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function n(a,b){var c=a.split("."),d=e;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)c.length||void 0===b?d[f]?d=d[f]:d=d[f]={}:d[f]=b}
function q(a,b){function c(){}c.prototype=b.prototype;a.aa=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.ba=function(a,c,l){for(var k=Array(arguments.length-2),p=2;p<arguments.length;p++)k[p-2]=arguments[p];return b.prototype[c].apply(a,k)}};n("onfire.model.Error",{INVALID_REF:"Invalid ref argument - it must be an onfire.Ref instance",NOT_LOADED:"Not loaded yet",NO_SUCH_KEY:"No such key",NOT_A_MODEL:"Not a model",NOT_A_PRIMITIVE:"Not a primitive"});function r(a){switch(typeof a){case "function":return u;case "object":return void 0!==a.$id?v:w}switch(a){case "string":return x;case "number":return y;case "boolean":return z;default:return fa}}var x=0,y=1,z=2,w=3,v=4,u=5,fa=-1;var A="undefined"!==typeof module&&!!module.exports;function B(a){C("info",arguments)}function ga(a){C("warn",arguments)}function D(a){C("error",arguments)}function C(a,b){var c=Array.prototype.slice.call(b,0);c.unshift("ONFIRE:");"function"===typeof console[a]?console[a].apply(console,c):console.log.apply(console,c)};function ha(a,b){this.c=a;this.f=b;this.b=0;this.a=null}function ia(a){var b;0<a.b?(a.b--,b=a.a,a.a=b.next,b.next=null):b=a.c();return b}function ja(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function E(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};var ka=Array.prototype;function la(a){return ka.concat.apply(ka,arguments)};var na=new ha(function(){return new ma},function(a){a.reset()});function oa(){var a=pa,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function ma(){this.next=this.b=this.a=null}ma.prototype.reset=function(){this.next=this.b=this.a=null};var F;a:{var qa=e.navigator;if(qa){var ra=qa.userAgent;if(ra){F=ra;break a}}F=""};function sa(a){e.setTimeout(function(){throw a;},0)}var ta;
function ua(){var a=e.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&-1==F.indexOf("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=m(function(a){if(("*"==d||a.origin==
d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&-1==F.indexOf("Trident")&&-1==F.indexOf("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.Z;c.Z=null;a()}};return function(a){d.next={Z:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=
document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){e.setTimeout(a,0)}};function va(a,b){G||wa();xa||(G(),xa=!0);var c=pa,d=ia(na);d.a=a;d.b=b;d.next=null;c.b?c.b.next=d:c.a=d;c.b=d}var G;function wa(){if(e.Promise&&e.Promise.resolve){var a=e.Promise.resolve(void 0);G=function(){a.then(ya)}}else G=function(){var a=ya;!h(e.setImmediate)||e.Window&&e.Window.prototype&&e.Window.prototype.setImmediate==e.setImmediate?(ta||(ta=ua()),ta(a)):e.setImmediate(a)}}var xa=!1,pa=new function(){this.b=this.a=null};
function ya(){for(var a=null;a=oa();){try{a.a.call(a.b)}catch(b){sa(b)}ja(na,a)}xa=!1};function H(a,b){this.a=I;this.i=void 0;this.c=this.b=this.g=null;this.f=this.h=!1;if(a!=g)try{var c=this;a.call(b,function(a){J(c,K,a)},function(a){try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}J(c,L,a)})}catch(d){J(this,L,d)}}var I=0,K=2,L=3;function za(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}za.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var Aa=new ha(function(){return new za},function(a){a.reset()});
function Ba(a,b,c){var d=ia(Aa);d.f=a;d.b=b;d.c=c;return d}function Ca(a,b,c){Da(a,b,c,null)||va(ea(b,a))}function Ea(a){return new H(function(b,c){var d=a.length,f=[];if(d)for(var l=function(a,c){d--;f[a]=c;0==d&&b(f)},k=function(a){c(a)},p=0,t;p<a.length;p++)t=a[p],Ca(t,ea(l,p),k);else b(f)})}H.prototype.then=function(a,b,c){return Fa(this,h(a)?a:null,h(b)?b:null,c)};H.prototype.then=H.prototype.then;H.prototype.$goog_Thenable=!0;
function Ga(a,b){a.b||a.a!=K&&a.a!=L||Ha(a);a.c?a.c.next=b:a.b=b;a.c=b}function Fa(a,b,c,d){var f=Ba(null,null,null);f.a=new H(function(a,k){f.f=b?function(c){try{var f=b.call(d,c);a(f)}catch(da){k(da)}}:a;f.b=c?function(b){try{var f=c.call(d,b);a(f)}catch(da){k(da)}}:k});f.a.g=a;Ga(a,f);return f.a}H.prototype.l=function(a){this.a=I;J(this,K,a)};H.prototype.m=function(a){this.a=I;J(this,L,a)};
function J(a,b,c){a.a==I&&(a==c&&(b=L,c=new TypeError("Promise cannot resolve to itself")),a.a=1,Da(c,a.l,a.m,a)||(a.i=c,a.a=b,a.g=null,Ha(a),b!=L||Ia(a,c)))}function Da(a,b,c,d){if(a instanceof H)return Ga(a,Ba(b||g,c||null,d)),!0;var f;if(a)try{f=!!a.$goog_Thenable}catch(k){f=!1}else f=!1;if(f)return a.then(b,c,d),!0;f=typeof a;if("object"==f&&null!=a||"function"==f)try{var l=a.then;if(h(l))return Ja(a,l,b,c,d),!0}catch(k){return c.call(d,k),!0}return!1}
function Ja(a,b,c,d,f){function l(a){p||(p=!0,d.call(f,a))}function k(a){p||(p=!0,c.call(f,a))}var p=!1;try{b.call(a,k,l)}catch(t){l(t)}}function Ha(a){a.h||(a.h=!0,va(a.j,a))}function Ka(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.c=null);return b}
H.prototype.j=function(){for(var a=null;a=Ka(this);){var b=this.a,c=this.i;if(b==L&&a.b&&!a.g)for(var d=void 0,d=this;d&&d.f;d=d.g)d.f=!1;if(a.a)a.a.g=null,La(a,b,c);else try{a.g?a.f.call(a.c):La(a,b,c)}catch(f){Ma.call(null,f)}ja(Aa,a)}this.h=!1};function La(a,b,c){b==K?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Ia(a,b){a.f=!0;va(function(){a.f&&Ma.call(null,b)})}var Ma=sa;var Na="undefined"!==typeof Promise;function M(a){return Na?new Promise(a):new H(a)}function Oa(a){if(Na)a=Promise.resolve(a);else if(!(a instanceof H)){var b=new H(g);J(b,K,a);a=b}return a}function Pa(a){return Na?Promise.all(a):Ea(a)};var Qa=A?require("firebase"):Firebase;function Ra(a,b){return M(function(c,d){if(void 0!==b)var f=a.push(b,function(a){a?d(a):c(f)});else c(a.push())})}function Sa(a,b){return M(function(c,d){a.set(b,function(a){a?d(a):c()})})}function Ta(a,b){return M(function(c,d){a.update(b,function(a){a?d(a):c()})})}function Ua(a,b){return M(function(c,d){a.transaction(b,function(a,b,k){a?d(a):c({isCommitted:b,snapshot:k})},!1)})}function Va(a){return M(function(b,c){a.remove(function(a){a?c(a):b()})})}
function Wa(a,b){return M(function(c,d){a.once(b,function(a){c(a)},function(a){d(a)})})}function Xa(a,b,c){return M(function(d,f){a.authWithCustomToken(b,function(a,b){a?f(a):d(b)},c)})}function Ya(a,b){return M(function(c,d){a.authAnonymously(function(a,b){a?d(a):c(b)},b)})}function Za(a,b,c){return M(function(d,f){a.authWithPassword(b,function(a,b){a?f(a):d(b)},c)})}function $a(a,b,c){return M(function(d,f){a.authWithOAuthPopup(b,function(a,b){a?f(a):d(b)},c)})}
function ab(a,b,c){return M(function(d,f){a.authWithOAuthRedirect(b,function(a){f(a)},c)})}function bb(a,b,c,d){return M(function(f,l){a.authWithOAuthToken(b,c,function(a,b){a?l(a):f(b)},d)})}function cb(a,b){return M(function(c,d){a.createUser(b,function(a,b){a?d(a):c(b)})})}function db(a,b){return M(function(c,d){a.changeEmail(b,function(a){a?d(a):c()})})}function eb(a,b){return M(function(c,d){a.changePassword(b,function(a){a?d(a):c()})})}
function fb(a,b){return M(function(c,d){a.removeUser(b,function(a){a?d(a):c()})})}function gb(a,b){return M(function(c,d){a.resetPassword(b,function(a){a?d(a):c()})})};function N(a,b){this.b={};this.a=[];this.f=this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)O(this,arguments[d],arguments[d+1])}else if(a){if(a instanceof N)c=a.G(),d=a.H();else{var c=E(a),f=[],l=0;for(d in a)f[l++]=a[d];d=f}for(f=0;f<c.length;f++)O(this,c[f],d[f])}}N.prototype.H=function(){hb(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};N.prototype.G=function(){hb(this);return this.a.concat()};
N.prototype.clear=function(){this.b={};this.f=this.c=this.a.length=0};function hb(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];P(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){for(var f={},c=b=0;b<a.a.length;)d=a.a[b],P(f,d)||(a.a[c++]=d,f[d]=1),b++;a.a.length=c}}function Q(a,b){return P(a.b,b)?a.b[b]:void 0}function O(a,b,c){P(a.b,b)||(a.c++,a.a.push(b),a.f++);a.b[b]=c}
N.prototype.forEach=function(a,b){for(var c=this.G(),d=0;d<c.length;d++){var f=c[d];a.call(b,Q(this,f),f,this)}};N.prototype.clone=function(){return new N(this)};function P(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var ib=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function jb(a,b){if(a)for(var c=a.split("&"),d=0;d<c.length;d++){var f=c[d].indexOf("="),l=null,k=null;0<=f?(l=c[d].substring(0,f),k=c[d].substring(f+1)):l=c[d];b(l,k?decodeURIComponent(k.replace(/\+/g," ")):"")}};function R(a,b){this.f=this.j=this.b="";this.i=null;this.h=this.c="";this.a=!1;var c;a instanceof R?(this.a=void 0!==b?b:a.a,kb(this,a.b),this.j=a.j,this.f=a.f,lb(this,a.i),this.c=a.c,mb(this,a.g.clone()),this.h=a.h):a&&(c=String(a).match(ib))?(this.a=!!b,kb(this,c[1]||"",!0),this.j=S(c[2]||""),this.f=S(c[3]||"",!0),lb(this,c[4]),this.c=S(c[5]||"",!0),mb(this,c[6]||"",!0),this.h=S(c[7]||"")):(this.a=!!b,this.g=new T(null,0,this.a))}
R.prototype.toString=function(){var a=[],b=this.b;b&&a.push(U(b,nb,!0),":");var c=this.f;if(c||"file"==b)a.push("//"),(b=this.j)&&a.push(U(b,nb,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.i,null!=c&&a.push(":",String(c));if(c=this.c)this.f&&"/"!=c.charAt(0)&&a.push("/"),a.push(U(c,"/"==c.charAt(0)?ob:pb,!0));(c=this.g.toString())&&a.push("?",c);(c=this.h)&&a.push("#",U(c,qb));return a.join("")};R.prototype.clone=function(){return new R(this)};
function kb(a,b,c){a.b=c?S(b,!0):b;a.b&&(a.b=a.b.replace(/:$/,""))}function lb(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.i=b}else a.i=null}function mb(a,b,c){b instanceof T?(a.g=b,rb(a.g,a.a)):(c||(b=U(b,sb)),a.g=new T(b,0,a.a))}function S(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function U(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,tb),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}
function tb(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var nb=/[#\/\?@]/g,pb=/[\#\?:]/g,ob=/[\#\?]/g,sb=/[\#\?@]/g,qb=/#/g;function T(a,b,c){this.c=this.a=null;this.b=a||null;this.f=!!c}function V(a){a.a||(a.a=new N,a.c=0,a.b&&jb(a.b,function(b,c){var d=decodeURIComponent(b.replace(/\+/g," "));V(a);a.b=null;var d=W(a,d),f=Q(a.a,d);f||O(a.a,d,f=[]);f.push(c);a.c++}))}
function ub(a,b){V(a);b=W(a,b);if(P(a.a.b,b)){a.b=null;a.c-=Q(a.a,b).length;var c=a.a;P(c.b,b)&&(delete c.b[b],c.c--,c.f++,c.a.length>2*c.c&&hb(c))}}T.prototype.clear=function(){this.a=this.b=null;this.c=0};T.prototype.G=function(){V(this);for(var a=this.a.H(),b=this.a.G(),c=[],d=0;d<b.length;d++)for(var f=a[d],l=0;l<f.length;l++)c.push(b[d]);return c};
T.prototype.H=function(a){V(this);var b=[];if("string"==typeof a){var c=a;V(this);c=W(this,c);P(this.a.b,c)&&(b=la(b,Q(this.a,W(this,a))))}else for(a=this.a.H(),c=0;c<a.length;c++)b=la(b,a[c]);return b};T.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";for(var a=[],b=this.a.G(),c=0;c<b.length;c++)for(var d=b[c],f=encodeURIComponent(String(d)),d=this.H(d),l=0;l<d.length;l++){var k=f;""!==d[l]&&(k+="="+encodeURIComponent(String(d[l])));a.push(k)}return this.b=a.join("&")};
T.prototype.clone=function(){var a=new T;a.b=this.b;this.a&&(a.a=this.a.clone(),a.c=this.c);return a};function W(a,b){var c=String(b);a.f&&(c=c.toLowerCase());return c}function rb(a,b){b&&!a.f&&(V(a),a.b=null,a.a.forEach(function(a,b){var f=b.toLowerCase();if(b!=f&&(ub(this,b),ub(this,f),0<a.length)){this.b=null;var l=this.a,f=W(this,f),k;k=a.length;if(0<k){for(var p=Array(k),t=0;t<k;t++)p[t]=a[t];k=p}else k=[];O(l,f,k);this.c+=a.length}},a));a.f=b};function X(a){"string"===typeof a&&(a=A?new Qa(a):new Firebase(a));this.a=a}n("onfire.Ref",X);X.prototype.authWithCustomToken=function(a,b){return Xa(this.a,a,b)};X.prototype.authWithCustomToken=X.prototype.authWithCustomToken;X.prototype.A=function(a){return Ya(this.a,a)};X.prototype.authAnonymously=X.prototype.A;X.prototype.F=function(a,b){return Za(this.a,a,b)};X.prototype.authWithPassword=X.prototype.F;X.prototype.B=function(a,b){return $a(this.a,a,b)};X.prototype.authWithOAuthPopup=X.prototype.B;
X.prototype.C=function(a,b){return ab(this.a,a,b)};X.prototype.authWithOAuthRedirect=X.prototype.C;X.prototype.D=function(a,b,c){return bb(this.a,a,b,c)};X.prototype.authWithOAuthToken=X.prototype.D;X.prototype.I=function(a){return db(this.a,a)};X.prototype.changeEmail=X.prototype.I;X.prototype.J=function(a){return eb(this.a,a)};X.prototype.changePassword=X.prototype.J;X.prototype.K=function(a){return cb(this.a,a)};X.prototype.createUser=X.prototype.K;X.prototype.L=function(){return this.a.getAuth()};
X.prototype.getAuth=X.prototype.L;X.prototype.N=function(){this.a.goOnline()};X.prototype.goOnline=X.prototype.N;X.prototype.M=function(){this.a.goOffline()};X.prototype.goOffline=X.prototype.M;X.prototype.P=function(a,b){this.a.onAuth(a,b)};X.prototype.onAuth=X.prototype.P;X.prototype.O=function(a,b){this.a.offAuth(a,b)};X.prototype.offAuth=X.prototype.O;X.prototype.Y=function(){this.a.unauth()};X.prototype.unauth=X.prototype.Y;X.prototype.f=function(a){return new X(this.a.child(a))};
X.prototype.child=X.prototype.f;X.prototype.i=function(){return this.a.push().key()};X.prototype.generateId=X.prototype.i;X.prototype.m=function(){return this.a.key()};X.prototype.key=X.prototype.m;X.prototype.h=function(a,b){this.a.off(a,b)};X.prototype.off=X.prototype.h;X.prototype.w=function(a){this.h("value",a)};X.prototype.offValue=X.prototype.w;
X.prototype.g=function(a,b,c,d){var f=this;return this.a.on(a,function(c,k){B(a.toUpperCase()+" at "+f.b(),c.val());b.call(d,c,k)},function(b){D(a.toUpperCase()+" CANCELLED at "+f.b(),b);"function"===typeof c&&c.call(d,b)})};X.prototype.on=X.prototype.g;
X.prototype.s=function(a){B("ONCE "+a.toUpperCase()+" "+this.b());var b=this;return Wa(this.a,a).then(function(c){B("ONCE "+a.toUpperCase()+" (Success) "+b.b(),c.val());return c},function(c){D("ONCE "+a.toUpperCase()+" (Failure) "+b.b(),c);throw c;})};X.prototype.once=X.prototype.s;X.prototype.l=function(){return this.s("value").then(function(a){return a.val()})};X.prototype.onceValue=X.prototype.l;X.prototype.j=function(a,b,c){return this.g("value",function(b){a.call(c,b.val())},b,c)};
X.prototype.onValue=X.prototype.j;X.prototype.R=function(){var a=this.a.parent();return a?new X(a):null};X.prototype.parent=X.prototype.R;X.prototype.b=function(){var a;if(!(a=this.c)){a=decodeURIComponent;var b=this.a.toString(),b=(b instanceof R?b.clone():new R(b,void 0)).c;a=this.c=a(b)||"/"}return a};X.prototype.path=X.prototype.b;
X.prototype.push=function(a){B("PUSH "+this.b()+" :",a);var b=this;return Ra(this.a,a).then(function(c){B("PUSH (Success) "+b.b()+" :",a);return new X(c)},function(c){D("PUSH (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.push=X.prototype.push;X.prototype.S=function(){return this.a};X.prototype.ref=X.prototype.S;
X.prototype.T=function(){B("REMOVE "+this.b());var a=this;return Va(this.a).then(function(){B("REMOVE (Success) "+a.b());return null},function(b){D("REMOVE (Failure) "+a.b(),b);throw b;})};X.prototype.remove=X.prototype.T;X.prototype.U=function(a){return fb(this.a,a)};X.prototype.removeUser=X.prototype.U;X.prototype.V=function(a){return gb(this.a,a)};X.prototype.resetPassword=X.prototype.V;X.prototype.W=function(){return new X(this.a.root())};X.prototype.root=X.prototype.W;
X.prototype.X=function(a){B("SET "+this.b()+" :",a);var b=this;return Sa(this.a,a).then(function(){B("SET (Success) "+b.b()+" :",a);return null},function(c){D("SET (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.set=X.prototype.X;X.prototype.u=function(a){B("TRANSACTION at "+this.b());var b=this;return Ua(this.a,a).then(function(a){B("TRANSACTION "+(a.isCommitted?"Committed":"Not Committed")+" at "+b.b()+" :",a.snapshot.val());return a},function(a){D("TRANSACTION Failed at "+b.b());throw a;})};
X.prototype.transaction=X.prototype.u;X.prototype.v=function(a){B("UPDATE "+this.b()+" :",a);var b=this;return Ta(this.a,a).then(function(){B("UPDATE (Success) "+b.b()+" :",a);return null},function(c){D("UPDATE (Failure) "+b.b()+" :",a,c);throw c;})};X.prototype.update=X.prototype.v;function Y(a){if(!(a instanceof X))throw Error("Invalid ref argument - it must be an onfire.Ref instance");this.b=a;this.s={};this.l=!1;this.h=0;this.f=null;this.D=[];this.v=[];this.o=this.K()}n("onfire.model.Model",Y);Y.prototype.u=function(){B("DISPOSE  "+this.b.b()+" ...");delete this.o;for(var a=0;a<this.v.length;a++)this.b.h.apply(this.b,this.v[a]);this.F=null;for(a=0;a<this.D.length;a++)this.D[a].u();B("DISPOSED "+this.b.b())};Y.prototype.dispose=Y.prototype.u;
function vb(a,b){a.f=b;var c=[],d;for(d in a.f){var f;switch(r(a.f[d])){case x:case y:case z:break;case w:case v:f=a[d+"Ctor_"];a[d+"Inst_"]=new f(a.b.f(d));c.push(a[d+"Inst_"].o);a.D.push(a[d+"Inst_"]);break;default:throw new TypeError("Invalid property type for "+d);}}a.o=a.o.then(function(){return Pa(c)}).then(function(){a.a=!0;return a});a.a=!1}
Y.prototype.K=function(){var a=this;return M(function(b,c){a.a=!1;var d=a.b.j(function(c){var d=a.a;wb(a,c);d||b(a)},function(b){a.a||c(b)});a.v.push(["value",d])})};Y.prototype.$=function(){return this.o};Y.prototype.whenLoaded=Y.prototype.$;Y.prototype.Y=function(){return this.b.m()};Y.prototype.key=Y.prototype.Y;Y.prototype.X=function(){if(!this.a)throw Error("Not loaded yet");return!!this.c};Y.prototype.exists=Y.prototype.X;Y.prototype.S=function(a){this.F=a};Y.prototype.onValueChanged=Y.prototype.S;
function wb(a,b){a.c=b;a.h=E(b).length;a.a=!0;a.F&&a.F.call(null)}Y.prototype.w=function(a){return a in this.f&&"string"!==typeof this.f[a]?this.j(a):this.i(a)};Y.prototype.get=Y.prototype.w;Y.prototype.i=function(a){if(!this.a)throw Error("Not loaded yet");if(this.c&&a in this.c)return this.c[a];if(a in this.f)return null;throw Error("No such key");};Y.prototype.getBasicValue=Y.prototype.i;
Y.prototype.j=function(a){if(!this.a)throw Error("Not loaded yet");if(!(a in this.f))throw Error("No such key");if("string"===typeof this.f[a])throw Error("Not a model");return this[a+"Inst_"]};Y.prototype.getModel=Y.prototype.j;Y.prototype.A=function(a,b){if(!this.a)throw Error("Not loaded yet");var c=a in this.f,d=this.c&&a in this.c;if(!c&&!d)throw Error("No such key");if(c&&"string"!==typeof this.f[a])throw Error("Not a primitive");this.s[a]=b;this.l=!0;return this};Y.prototype.set=Y.prototype.A;
Y.prototype.O=function(){return this.l};Y.prototype.hasChanges=Y.prototype.O;Y.prototype.J=function(){return this.l?xb(this,this.s).then(function(a){a.s={};a.l=!1;return a}):Oa(this)};Y.prototype.save=Y.prototype.J;function xb(a,b){var c=a.h;return a.b.v(b).then(function(){0<c&&0===a.h?B("REMOVED "+a.b.b()):0===c&&0<a.h&&B("CREATED "+a.b.b());return a})}function yb(a,b){return a.b.u(function(a){if(null===a)return b}).then(function(b){b.isCommitted&&B("CREATED "+a.b.b());return b})};function Z(a,b){Y.call(this,a);this.g=b}q(Z,Y);n("onfire.model.Collection",Z);Z.prototype.K=function(){var a=this,b=this.b.l().then(function(b){wb(a,b);return a});b.then(function(){var b=a.b.g("child_added",a.M,void 0,a),d=a.b.g("child_removed",a.N,void 0,a);a.v.push(["child_added",b,a]);a.v.push(["child_removed",d,a])});return b};Z.prototype.u=function(){Z.aa.u.call(this);this.C=this.B=null};Z.prototype.dispose=Z.prototype.u;Z.prototype.w=function(a){return this.g?this.j(a):this.i(a)};
Z.prototype.get=Z.prototype.w;Z.prototype.j=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");if(!this.m(a))throw Error("No such key");return new this.g(this.b.f(a))};Z.prototype.getModel=Z.prototype.j;Z.prototype.i=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.m(a))throw Error("No such key");return this.c[a]};Z.prototype.getBasicValue=Z.prototype.i;
Z.prototype.A=function(a,b){if(!this.a)throw Error("Not loaded yet");if(this.g)throw Error("Not a primitive");this.s[a]=b;this.l=!0;return this};Z.prototype.set=Z.prototype.A;Z.prototype.I=function(a){return this.j(a).o};Z.prototype.fetch=Z.prototype.I;Z.prototype.U=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");var b=this.b.i(),b=(new this.g(this.b.f(b))).o;a&&(b=b.then(function(b){return xb(b,a)}));return b};Z.prototype.create=Z.prototype.U;
Z.prototype.L=function(a,b){if(!this.a)throw Error("Not loaded yet");if(!this.g)throw Error("Not a model");return(new this.g(this.b.f(a))).o.then(function(a){return b?yb(a,b).then(function(){return a}):a})};Z.prototype.fetchOrCreate=Z.prototype.L;Z.prototype.W=function(a){if(!this.a)throw Error("Not loaded yet");if(!this.m(a))return Oa(null);this.s[a]=null;this.l=!0;return this.J().then(function(){return null})};Z.prototype.remove=Z.prototype.W;
Z.prototype.forEach=function(a){if(!this.a)throw Error("Not loaded yet");var b=[],c;for(c in this.c){var d=this.g?this.I(c):Oa(this.i(c)),d=d.then(function(b){return a.call(null,b,c)});b.push(d)}return Pa(b)};Z.prototype.forEach=Z.prototype.forEach;Z.prototype.T=function(){if(!this.a)throw Error("Not loaded yet");return this.h};Z.prototype.count=Z.prototype.T;Z.prototype.m=function(a){if(!this.a)throw Error("Not loaded yet");return!!this.c&&a in this.c};Z.prototype.containsKey=Z.prototype.m;
Z.prototype.V=function(){if(!this.a)throw Error("Not loaded yet");return E(this.c)};Z.prototype.keys=Z.prototype.V;Z.prototype.P=function(a){this.B=a};Z.prototype.onChildAdded=Z.prototype.P;Z.prototype.R=function(a){this.C=a};Z.prototype.onChildRemoved=Z.prototype.R;Z.prototype.M=function(a){this.c||(this.c={});var b=a.key(),c=!this.m(b);this.c[b]=a.val();c&&(this.h++,this.B&&this.B.call(null,a.key()))};
Z.prototype.N=function(a){var b=a.key();this.m(b)&&(delete this.c[b],this.h--,0===this.h&&(this.c=null),this.C&&this.C.call(null,a.key()))};function zb(a){switch(typeof a){case "function":return a;case "object":break;default:throw Error("Invalid schema - it must be an object or a constructor!");}return r(a)===v?Ab(a):Bb(a)}function Bb(a){function b(b){Y.call(this,b);vb(this,a)}q(b,Y);Cb(b,a);return b}function Ab(a){function b(a){Z.call(this,a,c)}a=a.$id;var c;switch(r(a)){case u:c=a;break;case w:case v:c=Bb(a)}q(b,Z);return b}
function Cb(a,b){for(var c in b){var d=b[c];switch(r(d)){case x:case y:case z:void 0===a.prototype[c]?a.prototype[c]=Db(c):ga(c+" clashes with a built-in property or method. Use the generic .get("+c+") / .set("+c+", value) methods to access this property.");break;case u:case w:case v:a.prototype[c+"Ctor_"]=zb(d);void 0===a.prototype[c]?a.prototype[c]=Eb(c):ga(c+" clashes with a built-in property or method. Use the generic .getModel("+c+") method to access this property.");break;default:throw new TypeError("Invalid property type for "+
c);}}}function Db(a){return function(b){return 0===arguments.length?this.w(a):this.A(a,b)}}function Eb(a){return function(){return this.w(a)}};n("onfire.defineModel",zb);A&&(module.exports=e.onfire);})();//# sourceMappingURL=./onfire.min.js.map

